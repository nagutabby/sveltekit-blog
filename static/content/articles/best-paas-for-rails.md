---
title: "Railsアプリに最適なPaaSを求めて"
image: "https://images.microcms-assets.io/assets/99c53a99ae2b4682938f6c435d83e3d9/65d9891af050446fa73815fc8caca3a1/Microsoft-Fluentui-Emoji-3d-Cloud-3d.1024.png"
publishedAt: 2023-07-05
updatedAt: 2024-05-01
---

<h1 id="h04ad15a1a0">Heroku難民を救いたい</h1><p>まずは、改めてHeroku離れが進んでいる理由を考えてみます。</p><h2 id="h07d2e8654a">フリープランの廃止</h2><p>2022年の途中までは、無料で使えるプランがあったのですが、現在は廃止されており、Railsをデプロイするのに最低でも毎月5ドルかかるようになりました。親会社であるSalesforceの業績の悪化に伴う改悪だと思います。</p><h2 id="h86959f95b4">GitHubのOAuthトークンの漏洩</h2><p>2022年に、Herokuが管理していたGitHubのOauthトークンが漏洩しました。その後、このトークンが悪用され、ユーザのハッシュ化されたパスワードが漏洩しました。</p><h1 id="h129b673b54">RailsをデプロイできるPaaS</h1><p>Herokuと同様に、簡単にデプロイできるサービスを使いたいという方もいらっしゃると思います。実際のところ私もそうです。</p><p>そこで、デプロイの手間を最小限に抑えるために、PaaSに限定して候補とその利点と欠点をまとめました。</p><h2 id="h6b8872c126">Railway</h2><p>Railwayは、Nixpacksという自社製のソフトウェアを利用してアプリをデプロイします。NixとDockerを組み合わせたものだそうです。</p><h3 id="h5244c135f7">利点</h3><h4 id="hb2b2211ff0">無料で使用できるリソースがある</h4><p>クレジットカードを登録すると、毎月5ドルまで無料でリソースを使用できます。目安としては、Railsとsqliteの組み合わせであれば1アプリまで無料でデプロイできます。</p><h4 id="hcff1bed9cc">無料の範囲内で使ってもアプリが勝手にスリープしない</h4><p>これはかなり大きい特徴だと思います。いくら趣味のアプリだとはいえ、スリープから復帰するまで待つのはだるいですからね。</p><h3 id="h89f616d631">欠点</h3><h4 id="ha2ec0e1f98">アプリのデプロイに時間がかかる</h4><p>デプロイする際に、rbenvを使ってRubyがインストールされるためデプロイが遅いです。加えて、Dokcerイメージのビルドでキャッシュが利用されません。そのため、Railsアプリの毎回のデプロイにおよそ5分かかります。</p><h4 id="h2ad28ebb4d">サービスが比較的不安定</h4><p>普通にデプロイするだけでも5分かかるのですが、障害が発生してデプロイに10分以上かかることがここ数ヶ月で2回ありました。</p><h4 id="h2f417e632a">デプロイ先のリージョンがアメリカ西部しかない</h4><p>日本のクライアントとアメリカ西部のサーバの間で通信すると遅延(RTT)が0.4秒くらいになります。そのため、Hotwireを使ってRailsアプリをSPA風にした場合にイベント発生からアニメーション開始までの時間が長くなり、ユーザ体験が少し悪くなります。CloudflareなどのCDNを利用すれば遅延を軽減できますが、素早いレスポンスが求められるアプリをデプロイする場合は注意が必要です。</p><h2 id="hcf54bdc7df">Fly.io</h2><p>Fly.ioは、Dockerfileなどのデプロイ用のファイルをプロジェクトディレクトリに生成してデプロイします。</p><h3 id="h5244c135f7">利点</h3><h4 id="hb2b2211ff0">無料で使用できるリソースがある</h4><p>クレジットカードを登録すると、共有CPU1コア、メモリ256MBのインスタンスを3つまで無料で使用できます。</p><h4 id="hcff1bed9cc">無料の範囲内で使ってもアプリが勝手にスリープしない</h4><p>デフォルトの設定では、一定時間アクセスが来ないと勝手にスリープしてしまいますが、設定を変更することでアプリを常に起動させておくことができます。</p><h4 id="h122cae2f7f">日本のリージョンがある</h4><p>アプリのデプロイ先として東京リージョンを選択できます。</p><h3 id="h89f616d631">欠点</h3><h4 id="h7822bc1299">CloudflareのDNSとの相性が悪い</h4><p>CloudflareのDNSを使って独自ドメインでアプリを公開する際に、SSL証明書の問題が原因でオリジンサーバとの接続が確立できず、エラーが発生することがあります。私の場合は、Cloudflareのプロキシをオフにした状態であっても、SSL証明書を発行するためのFly.io側の処理が行われず、代わりにCloudflareが発行したエッジのSSL証明書を使おうとしてもうまく行きませんでした。</p><h2 id="h1f6a8fd369">Render</h2><p>RenderはRailwayやFly.ioに比べてデプロイ環境の癖が少ないです。初心者でも扱いやすいと思います。</p><h3 id="h5244c135f7">利点</h3><h4 id="hb2b2211ff0">無料で使用できるリソースがある</h4><p>クレジットカードを登録せずに、一部のリソースを無料で使用できます。Railsアプリ1個、PostgreSQL1個、Redisインスタンス1個まで無料で使用できますが、15分間アクセスが無いアプリは自動的にスリープするなどの制約があります。</p><h4 id="hf3b2af13ba">有料でデプロイするという条件で比較すると、RailwayやFly.ioよりもデプロイが速い</h4><p>毎月7ドルかかるプランであるStarterプランでRailsアプリをデプロイしてみたところ、デプロイに1分30秒しかかかりませんでした！</p><p>Railwayは5分、Fly.ioは3分くらいかかっていたので今回比較したサービスの中で、デプロイが一番速いです。</p><h3 id="h89f616d631">欠点</h3><h4 id="hf41cd91228">無料で使えるリソースの制約が大きい</h4><p>一部の制約は先ほど述べましたが、無料の範囲内で使おうとすると、アプリが最後のアクセスから15分後に勝手にスリープしたり、PostgreSQLが90日後に利用できなくなったり、Redisを再起動するとRedis上のデータが全て削除されてしまったりします。</p><p>そのため、実質的には、中長期的に運用するアプリを無料でデプロイすることができません。</p><h1 id="h07baa2f1d0">RenderのStarterプランがおすすめ</h1><p>Railsアプリを無料でデプロイしたいという方には本当に申し訳ないのですが、RenderのStarterプランを使ってRailsとPostgreSQLのインスタンス代としてそれぞれ月7ドル払うことをおすすめします。前述したように、RailwayもFly.ioも深刻なバグを抱えています。また、Renderはデプロイが3つの中で一番速いです。以上のことから、RenderのStarterプランはかなりコスパがいいと思いました。</p>